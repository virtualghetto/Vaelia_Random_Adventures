#textdomain wesnoth-Vaelia_Random_Adventures

[scenario]
	id=02_vra_cave_p
	name= _ "Vaelia Random - Cave +"
	#{VRA_LEVEL_NAME "Vaelia Random - Cave +" ($timesForever)}
	map_generation=lua
	next_scenario=01_vra_select

	[generator]
		id="cavegen"
		config_name="Lua Cave Generator"
		create_map = << return wesnoth.require("cave_map_generator").generate_map(...) >>

		# In editor this is 50,50 Bottom right grid hex is 51,51
		map_width=52
		map_height=52
		village_density=30

		terrain_wall = "Xu"
		terrain_clear = "Uu"
		terrain_keep = "Kud"
		terrain_castle = "Cud"
		terrain_village = "Uu^Vu"

		#transform=flip_x
		#transform_chance=50

		[chamber]
			id=north
			# c: 25,5
			#x=21-29
			#y=1-9
			x=25
			y=5
			size=4
			jagged=2
			[item_location]
				id = 2
				place_castle = yes
			[/item_location]
		[/chamber]

		[chamber]
			id=west
			# c: 5,25
			#x=1-9
			#y=21-29
			x=5
			y=25
			size=4
			jagged=2
			[item_location]
				id = 3
				place_castle = yes
			[/item_location]
		[/chamber]

		[chamber]
			id=east
			# c: 45,25
			#x=41-49
			#y=21-29
			x=45
			y=25
			size=4
			jagged=2
			[item_location]
				id = 4
				place_castle = yes
			[/item_location]
		[/chamber]

		[chamber]
			id=south
			# c: 25,45
			#x=21-29
			#y=41-49
			x=25
			y=45
			size=4
			jagged=2
			[item_location]
				id = 5
				place_castle = yes
			[/item_location]
		[/chamber]

		[chamber]
			id=middle
			# c: 25,25
			x=21-29
			y=21-29
			#x=25
			#y=25
			size=4
			jagged=2
			{PASSAGE_NORMAL north 2 10 10}
			{PASSAGE_NORMAL west 2 10 10}
			{PASSAGE_NORMAL east 2 10 10}
			{PASSAGE_NORMAL south 2 10 10}
			[item_location]
				id = 1
				place_castle = yes
			[/item_location]
		[/chamber]

		[chamber]
			id=northwest
			# c: 5,5
			x=1-9
			y=1-9
			size=4
			jagged=2
			chance=80
			{PASSAGE_NORMAL north 2 40 40}
			{PASSAGE_NORMAL west 2 40 40}
			{PASSAGE_CHANCE 50 middle 1 2 2}
		[/chamber]

		[chamber]
			id=northeast
			# c: 45,5
			x=41-49
			y=1-9
			size=4
			jagged=2
			chance=80
			{PASSAGE_NORMAL north 2 40 40}
			{PASSAGE_NORMAL east 2 40 40}
			{PASSAGE_CHANCE 50 middle 1 2 2}
		[/chamber]

		[chamber]
			id=southwest
			# c: 5,45
			x=1-9
			y=41-49
			size=4
			jagged=2
			chance=80
			{PASSAGE_NORMAL west 2 40 40}
			{PASSAGE_NORMAL south 2 40 40}
			{PASSAGE_CHANCE 50 middle 1 2 2}
		[/chamber]

		[chamber]
			id=southeast
			# c: 45,45
			x=41-49
			y=41-49
			size=4
			jagged=2
			chance=80
			{PASSAGE_NORMAL east 2 40 40}
			{PASSAGE_NORMAL south 2 40 40}
			{PASSAGE_CHANCE 50 middle 1 2 2}
		[/chamber]

		{VRA_MINI_CHAMBER}

	[/generator]

	[event]
		name=prestart

		# Here we overlay a mask containing a rather random pattern of
		# suitable terrains on the map, because the map generator itself
		# only places the very basic terrains (floor, walls, etc)

		[terrain_mask]
			x,y=1,1
			# can this be randomly generated by lua?
			mask="{~add-ons/Vaelia_Random_Adventures/maps/02_vra_cave.mask}"

			[rule]
				old=Xu,Cud,Kud,Mv,Ql,Urb,Uu^Vu
				use_old=yes
			[/rule]
			[rule]
				old=Uu
				new=Rp,Urb,Ww,Wwg,Wwt,Wwf,Uu^Uf,Uu^Emf,Uue^Emf,Rb,Re,Uh,Uue,Uu^Vud
			[/rule]
			[rule]
				old=Uu
				new=Ur
				terrain=Ur
			[/rule]
		[/terrain_mask]
	[/event]

{VRA_SCENE_CAVE}
[/scenario]
